import { useHover } from "ahooks";
import { useEffect, useRef, useState } from "react";
import styled from "styled-components";

const Container = styled.div`
  @keyframes shaking {
    from,
    9% {
      transform: translate(-50%, -50%) rotate(0deg);
    }
    10%,
    20%,
    30% {
      transform: translate(-50%, -50%) rotate(10deg);
    }
    15%,
    25%,
    35% {
      transform: translate(-50%, -50%) rotate(-10deg);
    }
    to,
    36% {
      transform: translate(-50%, -50%) rotate(0deg);
    }
  }
  @keyframes rotateLeft {
    from {
      transform: rotate(0deg);
      opacity: 1;
    }
    to {
      transform: rotate(-10deg);
      opacity: 0;
    }
  }
  @keyframes rotateRight {
    from {
      transform: rotate(0deg);
      opacity: 1;
    }
    to {
      transform: rotate(10deg);
      opacity: 0;
    }
  }

  /* max-width: 312px; */
  aspect-ratio: 1;
  z-index: 2;
  position: relative;
  overflow: hidden;

  &:hover {
    .lock-svg:not([class="active"]) {
      animation-iteration-count: infinite;
      animation-name: shaking;
      animation-duration: 2s;
      filter: opacity(1) drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.5));
    }
  }

  &.active {
    div,
    img {
      /* filter: grayscale(0); */
    }
  }

  div,
  img {
    filter: grayscale(1) brightness(0.5);
    transition: all linear 1.2s 1.2s;
  }
  .lock-svg {
    transition: all 0.2s linear;
    z-index: 2;
    width: 60px;
    height: 60px;
    position: absolute;
    top: 50%;
    left: 50%;
    filter: opacity(0.7) drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.5));
    transform: translate(-50%, -50%);
    animation-duration: 2s;
    animation-timing-function: linear;
    g {
      transform-origin: bottom;
      animation-duration: 2s;
      animation-timing-function: linear;
      &:nth-of-type(1) {
        transform: translate(.1px);
      }
      &:nth-of-type(2) {
        transform: translate(-.1px);
      }
    }
    &.force-active{
      & g:nth-of-type(1), g:nth-of-type(2){
        opacity: 0;
      } 
    }
    &.active {
      g:nth-of-type(1) {
        animation-name: rotateLeft;
        animation-fill-mode: forwards;
      }
      g:nth-of-type(2) {
        animation-name: rotateRight;
        animation-fill-mode: forwards;
      }
    }
  }

  .Subtract_570 {
    transform-origin: center;
    animation: 2s linear 0s 1 normal forwards running Subtract_570;
    animation-iteration-count: infinite;
    transform: translateX(-2.15px) translateY(3.3px) rotate(0deg);
    width: 40px;
    height: 46px;
  }

  &.unlocked {
    .lock-svg {
      opacity: 0;
    }
    div,
    img {
      filter: grayscale(0);
    }
  }
`;

const Wrapper = styled.div`
  position: relative;
  cursor: pointer;
  @keyframes shining {
    from,
    to {
      opacity: 0;
      z-index: 3;
      width: 40px;
      height: 40px;
    }
    20%,
    40% {
      opacity: 1;
      z-index: 3;
      width: 40px;
      height: 40px;
    }
    90% {
      z-index: 3;
      width: 40px;
      height: 40px;
      opacity: 0;
    }
  }
  .shining-shadow {
    position: absolute;
    top: 50%;
    left: 50%;
    z-index: -1;
    background-color: #fff;
    opacity: 0;
    transform: translate(-50%, -50%);
    box-shadow: 0 0 35px 80px #fff;
  }
  &.active .shining-shadow {
    animation: shining 3s 0.4s linear forwards;
  }
`;
// onAnimationEnd
export default ({
  onAnimationEnd,
  delay = 0,
  autoPlay = false,
  children,
  allowAnimation = true,
  skipAnimationForceUnlocked = false
}: any) => {
  const [ifActive, setIfActive] = useState(false);
  const [unlocked, setUnlocked] = useState(false);

  const handleClick = () => {
    if (!allowAnimation) return;
    setIfActive(true);
    setTimeout(() => {
      setUnlocked(true);
    }, 2000);
  };

  useEffect(() => {
    if (autoPlay) {
      setTimeout(() => {
        setIfActive(true);
        setTimeout(() => {
          setUnlocked(true);
        }, 2000);
      }, 500 + +delay);
    }
  }, [autoPlay, delay]);

  const ref = useRef(null);
  const isHovering = useHover(ref);


  useEffect(()=>{
    if(unlocked){
      onAnimationEnd && onAnimationEnd()
    }
  }, [unlocked, onAnimationEnd])
  //   useEffect(() => {
  //     if (!isHovering) {
  //       setIfActive(false);
  //     }
  //   }, [isHovering]);

  return (
    <Wrapper
      className={`${skipAnimationForceUnlocked ? 'force-active unlocked' : ifActive ? "active" : ""} ${unlocked ? "unlocked" : ""}`}
    >
      <Container
        onClick={handleClick}
        ref={ref}
        className={`${skipAnimationForceUnlocked ? 'force-active unlocked' : ifActive ? "active" : ""} ${unlocked ? "unlocked" : ""}`}
      >
        {children}
        <svg
          className={`lock-svg ${skipAnimationForceUnlocked ? 'force-active unlocked' : ifActive ? "active" : ""} ${
            unlocked ? "unlocked" : ""
          }`}
          width="41"
          height="46"
          viewBox="0 0 41 46"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <mask
            id="mask0_7787_35535"
            maskUnits="userSpaceOnUse"
            x="0"
            y="0"
            width="41"
            height="46"
          >
            <mask id="path-1-inside-1_7787_35535" fill="white">
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M14.064 16.981L26.2405 16.981L26.2405 12.0033C26.2405 8.68865 23.5147 6.00163 20.1522 6.00163C16.7898 6.00163 14.064 8.68865 14.064 12.0033L14.064 16.981ZM7.97575 16.981L5.14014 16.981C2.37871 16.981 0.140137 19.2196 0.140137 21.981L0.140137 40.9994C0.140137 43.7608 2.37871 45.9994 5.14014 45.9994L35.1401 45.9994C37.9016 45.9994 40.1401 43.7609 40.1401 40.9994L40.1401 21.981C40.1401 19.2196 37.9016 16.981 35.1401 16.981L32.3287 16.981L32.3287 12.0033C32.3287 5.37404 26.8771 0 20.1522 0C13.4273 0 7.97575 5.37404 7.97575 12.0033L7.97575 16.981ZM22.067 32.4829C23.3039 31.8022 24.1421 30.4859 24.1421 28.9736C24.1421 26.7632 22.3512 24.9713 20.1421 24.9713C17.9329 24.9713 16.1421 26.7632 16.1421 28.9736C16.1421 30.4784 16.9721 31.7893 18.199 32.4728C18.1551 32.6376 18.1317 32.8108 18.1317 32.9894L18.1317 35.9941C18.1317 37.0987 19.0271 37.9941 20.1317 37.9941C21.2362 37.9941 22.1317 37.0987 22.1317 35.9941L22.1317 32.9894C22.1317 32.8144 22.1092 32.6447 22.067 32.4829Z"
              />
            </mask>
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M14.064 16.981L26.2405 16.981L26.2405 12.0033C26.2405 8.68865 23.5147 6.00163 20.1522 6.00163C16.7898 6.00163 14.064 8.68865 14.064 12.0033L14.064 16.981ZM7.97575 16.981L5.14014 16.981C2.37871 16.981 0.140137 19.2196 0.140137 21.981L0.140137 40.9994C0.140137 43.7608 2.37871 45.9994 5.14014 45.9994L35.1401 45.9994C37.9016 45.9994 40.1401 43.7609 40.1401 40.9994L40.1401 21.981C40.1401 19.2196 37.9016 16.981 35.1401 16.981L32.3287 16.981L32.3287 12.0033C32.3287 5.37404 26.8771 0 20.1522 0C13.4273 0 7.97575 5.37404 7.97575 12.0033L7.97575 16.981ZM22.067 32.4829C23.3039 31.8022 24.1421 30.4859 24.1421 28.9736C24.1421 26.7632 22.3512 24.9713 20.1421 24.9713C17.9329 24.9713 16.1421 26.7632 16.1421 28.9736C16.1421 30.4784 16.9721 31.7893 18.199 32.4728C18.1551 32.6376 18.1317 32.8108 18.1317 32.9894L18.1317 35.9941C18.1317 37.0987 19.0271 37.9941 20.1317 37.9941C21.2362 37.9941 22.1317 37.0987 22.1317 35.9941L22.1317 32.9894C22.1317 32.8144 22.1092 32.6447 22.067 32.4829Z"
              fill="white"
            />
            <path
              d="M26.2405 16.981L26.2405 24.981L34.2405 24.981L34.2405 16.981L26.2405 16.981ZM14.064 16.981L6.06399 16.981L6.06399 24.981L14.064 24.981L14.064 16.981ZM7.97575 16.981L7.97575 24.981L15.9757 24.981L15.9757 16.981L7.97575 16.981ZM32.3287 16.981L24.3287 16.981L24.3287 24.981L32.3287 24.981L32.3287 16.981ZM22.067 32.4829L18.2099 25.4742L12.7536 28.4769L14.3262 34.503L22.067 32.4829ZM18.199 32.4728L25.9291 34.5335L27.5334 28.5155L22.0926 25.4843L18.199 32.4728ZM26.2405 8.98101L14.064 8.98101L14.064 24.981L26.2405 24.981L26.2405 8.98101ZM34.2405 16.981L34.2405 12.0033L18.2405 12.0033L18.2405 16.981L34.2405 16.981ZM34.2405 12.0033C34.2405 4.1627 27.8245 -1.99837 20.1522 -1.99837L20.1522 14.0016C19.2048 14.0016 18.2405 13.2146 18.2405 12.0033L34.2405 12.0033ZM20.1522 -1.99837C12.48 -1.99837 6.06399 4.1627 6.06399 12.0033L22.064 12.0033C22.064 13.2146 21.0996 14.0016 20.1522 14.0016L20.1522 -1.99837ZM6.06399 12.0033L6.06399 16.981L22.064 16.981L22.064 12.0033L6.06399 12.0033ZM7.97575 8.98101L5.14014 8.98101L5.14014 24.981L7.97575 24.981L7.97575 8.98101ZM5.14014 8.98101C-2.03956 8.98101 -7.85986 14.8013 -7.85986 21.981L8.14014 21.981C8.14014 23.6379 6.79699 24.981 5.14014 24.981L5.14014 8.98101ZM-7.85986 21.981L-7.85986 40.9994L8.14014 40.9994L8.14014 21.981L-7.85986 21.981ZM-7.85986 40.9994C-7.85986 48.1791 -2.03957 53.9994 5.14014 53.9994L5.14014 37.9994C6.79699 37.9994 8.14014 39.3426 8.14014 40.9994L-7.85986 40.9994ZM5.14014 53.9994L35.1401 53.9994L35.1401 37.9994L5.14014 37.9994L5.14014 53.9994ZM35.1401 53.9994C42.3198 53.9994 48.1401 48.1791 48.1401 40.9994L32.1401 40.9994C32.1401 39.3426 33.4833 37.9994 35.1401 37.9994L35.1401 53.9994ZM48.1401 40.9994L48.1401 21.981L32.1401 21.981L32.1401 40.9994L48.1401 40.9994ZM48.1401 21.981C48.1401 14.8013 42.3198 8.98101 35.1401 8.98101L35.1401 24.981C33.4833 24.981 32.1401 23.6379 32.1401 21.981L48.1401 21.981ZM35.1401 8.98101L32.3287 8.98101L32.3287 24.981L35.1401 24.981L35.1401 8.98101ZM40.3287 16.981L40.3287 12.0033L24.3287 12.0033L24.3287 16.981L40.3287 16.981ZM40.3287 12.0033C40.3287 0.848087 31.1869 -8 20.1522 -8L20.1522 8C22.5673 8 24.3287 9.9 24.3287 12.0033L40.3287 12.0033ZM20.1522 -8C9.11752 -8 -0.0242515 0.848089 -0.0242515 12.0033L15.9757 12.0033C15.9757 9.9 17.7372 8 20.1522 8L20.1522 -8ZM-0.0242515 12.0033L-0.0242515 16.981L15.9757 16.981L15.9757 12.0033L-0.0242515 12.0033ZM16.1421 28.9736C16.1421 27.4548 16.993 26.1438 18.2099 25.4742L25.9241 39.4917C29.6147 37.4606 32.1421 33.5169 32.1421 28.9736L16.1421 28.9736ZM20.1421 32.9713C17.9285 32.9713 16.1421 31.177 16.1421 28.9736L32.1421 28.9736C32.1421 22.3493 26.7739 16.9713 20.1421 16.9713L20.1421 32.9713ZM24.1421 28.9736C24.1421 31.177 22.3557 32.9713 20.1421 32.9713L20.1421 16.9713C13.5102 16.9713 8.14209 22.3493 8.14209 28.9736L24.1421 28.9736ZM22.0926 25.4843C23.2993 26.1566 24.1421 27.4623 24.1421 28.9736L8.14209 28.9736C8.14209 33.4945 10.6449 37.422 14.3055 39.4614L22.0926 25.4843ZM26.1317 32.9894C26.1317 33.5126 26.0627 34.032 25.9291 34.5335L10.469 30.4122C10.2474 31.2432 10.1317 32.1089 10.1317 32.9894L26.1317 32.9894ZM26.1317 35.9941L26.1317 32.9894L10.1317 32.9894L10.1317 35.9941L26.1317 35.9941ZM20.1317 29.9941C23.4454 29.9941 26.1317 32.6805 26.1317 35.9941L10.1317 35.9941C10.1317 41.517 14.6088 45.9941 20.1317 45.9941L20.1317 29.9941ZM14.1317 35.9941C14.1317 32.6805 16.818 29.9941 20.1317 29.9941L20.1317 45.9941C25.6545 45.9941 30.1317 41.517 30.1317 35.9941L14.1317 35.9941ZM14.1317 32.9894L14.1317 35.9941L30.1317 35.9941L30.1317 32.9894L14.1317 32.9894ZM14.3262 34.503C14.1978 34.0109 14.1317 33.5019 14.1317 32.9894L30.1317 32.9894C30.1317 32.1269 30.0206 31.2785 29.8077 30.4628L14.3262 34.503Z"
              fill="white"
              mask="url(#path-1-inside-1_7787_35535)"
            />
          </mask>
          <g mask="url(#mask0_7787_35535)">
            <path
              d="M21.5 3.5L17 -4.5L-9.5 -4.5L-11 53H19.5L23 41L18.5 31L23 21L19.5 11L21.5 3.5Z"
              fill="white"
            />
          </g>
          <mask
            id="mask1_7787_35535"
            maskUnits="userSpaceOnUse"
            x="0"
            y="0"
            width="41"
            height="46"
          >
            <mask id="path-4-inside-2_7787_35535" fill="white">
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M14.064 16.981L26.2405 16.981L26.2405 12.0033C26.2405 8.68865 23.5147 6.00163 20.1522 6.00163C16.7898 6.00163 14.064 8.68865 14.064 12.0033L14.064 16.981ZM7.97575 16.981L5.14014 16.981C2.37871 16.981 0.140137 19.2196 0.140137 21.981L0.140137 40.9994C0.140137 43.7608 2.37871 45.9994 5.14014 45.9994L35.1401 45.9994C37.9016 45.9994 40.1401 43.7609 40.1401 40.9994L40.1401 21.981C40.1401 19.2196 37.9016 16.981 35.1401 16.981L32.3287 16.981L32.3287 12.0033C32.3287 5.37404 26.8771 0 20.1522 0C13.4273 0 7.97575 5.37404 7.97575 12.0033L7.97575 16.981ZM22.067 32.4829C23.3039 31.8022 24.1421 30.4859 24.1421 28.9736C24.1421 26.7632 22.3512 24.9713 20.1421 24.9713C17.9329 24.9713 16.1421 26.7632 16.1421 28.9736C16.1421 30.4784 16.9721 31.7893 18.199 32.4728C18.1551 32.6376 18.1317 32.8108 18.1317 32.9894L18.1317 35.9941C18.1317 37.0987 19.0271 37.9941 20.1317 37.9941C21.2362 37.9941 22.1317 37.0987 22.1317 35.9941L22.1317 32.9894C22.1317 32.8144 22.1092 32.6447 22.067 32.4829Z"
              />
            </mask>
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M14.064 16.981L26.2405 16.981L26.2405 12.0033C26.2405 8.68865 23.5147 6.00163 20.1522 6.00163C16.7898 6.00163 14.064 8.68865 14.064 12.0033L14.064 16.981ZM7.97575 16.981L5.14014 16.981C2.37871 16.981 0.140137 19.2196 0.140137 21.981L0.140137 40.9994C0.140137 43.7608 2.37871 45.9994 5.14014 45.9994L35.1401 45.9994C37.9016 45.9994 40.1401 43.7609 40.1401 40.9994L40.1401 21.981C40.1401 19.2196 37.9016 16.981 35.1401 16.981L32.3287 16.981L32.3287 12.0033C32.3287 5.37404 26.8771 0 20.1522 0C13.4273 0 7.97575 5.37404 7.97575 12.0033L7.97575 16.981ZM22.067 32.4829C23.3039 31.8022 24.1421 30.4859 24.1421 28.9736C24.1421 26.7632 22.3512 24.9713 20.1421 24.9713C17.9329 24.9713 16.1421 26.7632 16.1421 28.9736C16.1421 30.4784 16.9721 31.7893 18.199 32.4728C18.1551 32.6376 18.1317 32.8108 18.1317 32.9894L18.1317 35.9941C18.1317 37.0987 19.0271 37.9941 20.1317 37.9941C21.2362 37.9941 22.1317 37.0987 22.1317 35.9941L22.1317 32.9894C22.1317 32.8144 22.1092 32.6447 22.067 32.4829Z"
              fill="white"
            />
            <path
              d="M26.2405 16.981L26.2405 24.981L34.2405 24.981L34.2405 16.981L26.2405 16.981ZM14.064 16.981L6.06399 16.981L6.06399 24.981L14.064 24.981L14.064 16.981ZM7.97575 16.981L7.97575 24.981L15.9757 24.981L15.9757 16.981L7.97575 16.981ZM32.3287 16.981L24.3287 16.981L24.3287 24.981L32.3287 24.981L32.3287 16.981ZM22.067 32.4829L18.2099 25.4742L12.7536 28.4769L14.3262 34.503L22.067 32.4829ZM18.199 32.4728L25.9291 34.5335L27.5334 28.5155L22.0926 25.4843L18.199 32.4728ZM26.2405 8.98101L14.064 8.98101L14.064 24.981L26.2405 24.981L26.2405 8.98101ZM34.2405 16.981L34.2405 12.0033L18.2405 12.0033L18.2405 16.981L34.2405 16.981ZM34.2405 12.0033C34.2405 4.1627 27.8245 -1.99837 20.1522 -1.99837L20.1522 14.0016C19.2048 14.0016 18.2405 13.2146 18.2405 12.0033L34.2405 12.0033ZM20.1522 -1.99837C12.48 -1.99837 6.06399 4.1627 6.06399 12.0033L22.064 12.0033C22.064 13.2146 21.0996 14.0016 20.1522 14.0016L20.1522 -1.99837ZM6.06399 12.0033L6.06399 16.981L22.064 16.981L22.064 12.0033L6.06399 12.0033ZM7.97575 8.98101L5.14014 8.98101L5.14014 24.981L7.97575 24.981L7.97575 8.98101ZM5.14014 8.98101C-2.03956 8.98101 -7.85986 14.8013 -7.85986 21.981L8.14014 21.981C8.14014 23.6379 6.79699 24.981 5.14014 24.981L5.14014 8.98101ZM-7.85986 21.981L-7.85986 40.9994L8.14014 40.9994L8.14014 21.981L-7.85986 21.981ZM-7.85986 40.9994C-7.85986 48.1791 -2.03957 53.9994 5.14014 53.9994L5.14014 37.9994C6.79699 37.9994 8.14014 39.3426 8.14014 40.9994L-7.85986 40.9994ZM5.14014 53.9994L35.1401 53.9994L35.1401 37.9994L5.14014 37.9994L5.14014 53.9994ZM35.1401 53.9994C42.3198 53.9994 48.1401 48.1791 48.1401 40.9994L32.1401 40.9994C32.1401 39.3426 33.4833 37.9994 35.1401 37.9994L35.1401 53.9994ZM48.1401 40.9994L48.1401 21.981L32.1401 21.981L32.1401 40.9994L48.1401 40.9994ZM48.1401 21.981C48.1401 14.8013 42.3198 8.98101 35.1401 8.98101L35.1401 24.981C33.4833 24.981 32.1401 23.6379 32.1401 21.981L48.1401 21.981ZM35.1401 8.98101L32.3287 8.98101L32.3287 24.981L35.1401 24.981L35.1401 8.98101ZM40.3287 16.981L40.3287 12.0033L24.3287 12.0033L24.3287 16.981L40.3287 16.981ZM40.3287 12.0033C40.3287 0.848087 31.1869 -8 20.1522 -8L20.1522 8C22.5673 8 24.3287 9.9 24.3287 12.0033L40.3287 12.0033ZM20.1522 -8C9.11752 -8 -0.0242515 0.848089 -0.0242515 12.0033L15.9757 12.0033C15.9757 9.9 17.7372 8 20.1522 8L20.1522 -8ZM-0.0242515 12.0033L-0.0242515 16.981L15.9757 16.981L15.9757 12.0033L-0.0242515 12.0033ZM16.1421 28.9736C16.1421 27.4548 16.993 26.1438 18.2099 25.4742L25.9241 39.4917C29.6147 37.4606 32.1421 33.5169 32.1421 28.9736L16.1421 28.9736ZM20.1421 32.9713C17.9285 32.9713 16.1421 31.177 16.1421 28.9736L32.1421 28.9736C32.1421 22.3493 26.7739 16.9713 20.1421 16.9713L20.1421 32.9713ZM24.1421 28.9736C24.1421 31.177 22.3557 32.9713 20.1421 32.9713L20.1421 16.9713C13.5102 16.9713 8.14209 22.3493 8.14209 28.9736L24.1421 28.9736ZM22.0926 25.4843C23.2993 26.1566 24.1421 27.4623 24.1421 28.9736L8.14209 28.9736C8.14209 33.4945 10.6449 37.422 14.3055 39.4614L22.0926 25.4843ZM26.1317 32.9894C26.1317 33.5126 26.0627 34.032 25.9291 34.5335L10.469 30.4122C10.2474 31.2432 10.1317 32.1089 10.1317 32.9894L26.1317 32.9894ZM26.1317 35.9941L26.1317 32.9894L10.1317 32.9894L10.1317 35.9941L26.1317 35.9941ZM20.1317 29.9941C23.4454 29.9941 26.1317 32.6805 26.1317 35.9941L10.1317 35.9941C10.1317 41.517 14.6088 45.9941 20.1317 45.9941L20.1317 29.9941ZM14.1317 35.9941C14.1317 32.6805 16.818 29.9941 20.1317 29.9941L20.1317 45.9941C25.6545 45.9941 30.1317 41.517 30.1317 35.9941L14.1317 35.9941ZM14.1317 32.9894L14.1317 35.9941L30.1317 35.9941L30.1317 32.9894L14.1317 32.9894ZM14.3262 34.503C14.1978 34.0109 14.1317 33.5019 14.1317 32.9894L30.1317 32.9894C30.1317 32.1269 30.0206 31.2785 29.8077 30.4628L14.3262 34.503Z"
              fill="white"
              mask="url(#path-4-inside-2_7787_35535)"
            />
          </mask>
          <g mask="url(#mask1_7787_35535)">
            <path
              d="M21.5 3.5L17 -4.5L48.5 -4.5V52L19.5 53L23 41L18.5 31L23 21L19.5 11L21.5 3.5Z"
              fill="white"
            />
          </g>
        </svg>
      </Container>

      <div className="shining-shadow" />
    </Wrapper>
  );
};
